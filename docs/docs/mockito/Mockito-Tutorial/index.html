<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Mockito 教程  原文： https://www.cnblogs.com/Ming8006/p/6297333.html
 1.0 Mockito 介绍 [3] 1.1 Mockito是什么？ Mockito 是 Mock 框架，它让你用简洁的 API 做测试。而且 Mockito 简单易学，它可读性强、验证语法简洁。
1.2 为什么需要Mock 测试驱动的开发( TDD) 要求我们先写单元测试，再写实现代码。在写单元测试的过程中，我们往往会遇到要测试的类有很多依赖，这些依赖的类、对象、资源又有别的依赖，从而形成一个大的依赖树，要在单元测试的环境中完整地构建这样的依赖，是一件很困难的事情。
1.3 Stub 和 Mock 异同[1]  相同：Stub 和 Mock 都是模拟外部依赖 不同：Stub 是完全模拟一个外部依赖， 而 Mock 还可以用来判断测试通过还是失败  1.4 使用场景  提前创建测试 TDD（测试驱动开发） 团队可以并行工作 你可以创建一个验证或者演示程序 为无法访问的资源编写测试 Mock 可以交给用户 隔离系统  2 使用Mockito [2] [4] 添加 Maven 依赖
&lt;dependency&gt; &lt;groupId&gt;org.mockito&lt;/groupId&gt; &lt;artifactId&gt;mockito-all&lt;/artifactId&gt; &lt;version&gt;1.10.19&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; 添加 JUnit依赖
&lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4."><meta property="og:title" content="" />
<meta property="og:description" content="Mockito 教程  原文： https://www.cnblogs.com/Ming8006/p/6297333.html
 1.0 Mockito 介绍 [3] 1.1 Mockito是什么？ Mockito 是 Mock 框架，它让你用简洁的 API 做测试。而且 Mockito 简单易学，它可读性强、验证语法简洁。
1.2 为什么需要Mock 测试驱动的开发( TDD) 要求我们先写单元测试，再写实现代码。在写单元测试的过程中，我们往往会遇到要测试的类有很多依赖，这些依赖的类、对象、资源又有别的依赖，从而形成一个大的依赖树，要在单元测试的环境中完整地构建这样的依赖，是一件很困难的事情。
1.3 Stub 和 Mock 异同[1]  相同：Stub 和 Mock 都是模拟外部依赖 不同：Stub 是完全模拟一个外部依赖， 而 Mock 还可以用来判断测试通过还是失败  1.4 使用场景  提前创建测试 TDD（测试驱动开发） 团队可以并行工作 你可以创建一个验证或者演示程序 为无法访问的资源编写测试 Mock 可以交给用户 隔离系统  2 使用Mockito [2] [4] 添加 Maven 依赖
&lt;dependency&gt; &lt;groupId&gt;org.mockito&lt;/groupId&gt; &lt;artifactId&gt;mockito-all&lt;/artifactId&gt; &lt;version&gt;1.10.19&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; 添加 JUnit依赖
&lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hello-world-example.github.io/Mock/docs/mockito/Mockito-Tutorial/" />
<meta property="article:modified_time" content="2021-01-26T15:33:40+08:00" />
<title>Mockito Tutorial | Mock</title>
<link rel="icon" href="/Mock/favicon.png" type="image/x-icon">


<link rel="stylesheet" href="/Mock/book.min.d436f463c9471cfab26a8b71cd2f50b6abf5225806391453da4ca111d1834fef.css" integrity="sha256-1Db0Y8lHHPqyaotxzS9Qtqv1IlgGORRT2kyhEdGDT&#43;8=">


<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/Mock"><span>Mock</span>
  </a>
</h2>












  <ul>
<li><strong>JUnit4</strong>
<ul>
<li>
  <a href="/Mock/docs/junit4/RunWith/">@RunWith</a></li>
<li>
  <a href="/Mock/docs/junit4/Rule/">@Rule</a></li>
</ul>
</li>
<li>
  <a href="/Mock/docs/Mock-Introduction/">Mock 简介</a></li>
<li><strong>Mockito</strong>
<ul>
<li>
  <a href="/Mock/docs/mockito/Java-Doc/">[译] Java Doc</a></li>
<li>
  <a href="/Mock/docs/mockito/Mockito-Tutorial/"class=active>[转] Mockito 教程</a></li>
<li>
  <a href="/Mock/docs/mockito/in-action/DAO-Simple/">Mock 持久层依赖</a></li>
</ul>
</li>
<li><strong>Power Mock</strong>
<ul>
<li>
  <a href="/Mock/docs/powermock/Introduction/">Power Mock 介绍</a></li>
</ul>
</li>
<li><strong>Spring Test</strong>
<ul>
<li>
  <a href="/Mock/docs/spring-test/MockMvc/">MockMvc</a></li>
<li>
  <a href="/Mock/docs/spring-test/WebTestClient/">WebTestClient</a></li>
</ul>
</li>
<li>
  <a href="//hello-world-example.github.io/Spring-Boot/#/unit-test/index">Spring Boot Test</a></li>
</ul>










</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/Mock/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Mockito Tutorial</strong>

  <label for="toc-control">
    <img src="/Mock/svg/toc.svg" class="book-icon" alt="Table of Contents" />
  </label>
</div>


  
    <input type="checkbox" class="hidden" id="toc-control" />
    <aside class="hidden clearfix">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#mockito-教程">Mockito 教程</a>
      <ul>
        <li><a href="#10-mockito-介绍-sup3sup">1.0 Mockito 介绍 <sup>[3]</sup></a>
          <ul>
            <li><a href="#11-mockito是什么">1.1 Mockito是什么？</a></li>
            <li><a href="#12-为什么需要mock">1.2 为什么需要Mock</a></li>
            <li><a href="#13-stub-和-mock-异同sup1sup">1.3 Stub 和 Mock 异同<sup>[1]</sup></a></li>
            <li><a href="#14-使用场景">1.4 使用场景</a></li>
          </ul>
        </li>
        <li><a href="#2-使用mockito-sup2-4sup">2 使用Mockito <sup>[2] [4]</sup></a>
          <ul>
            <li><a href="#21-验证行为">2.1 验证行为</a></li>
            <li><a href="#22-模拟期望">2.2 模拟期望</a></li>
            <li><a href="#23-mock-参数">2.3 mock() 参数</a></li>
            <li><a href="#24-模拟抛出异常">2.4 模拟抛出异常</a></li>
            <li><a href="#25-mock-注解">2.5 @Mock 注解</a></li>
            <li><a href="#26-参数匹配">2.6 参数匹配</a></li>
            <li><a href="#27-自定义参数匹配">2.7 自定义参数匹配</a></li>
            <li><a href="#28-参数捕获器">2.8 参数捕获器</a></li>
            <li><a href="#29-answer">2.9 Answer</a></li>
            <li><a href="#210-未预设调用的默认期望">2.10 未预设调用的默认期望</a></li>
            <li><a href="#211-spy">2.11 spy</a></li>
            <li><a href="#212-真实-mock">2.12 真实 Mock</a></li>
            <li><a href="#213-重置-mock">2.13 重置 Mock</a></li>
            <li><a href="#214-验证调用次数">2.14 验证调用次数</a></li>
            <li><a href="#215-when-then-注意事项">2.15 when-then 注意事项</a></li>
            <li><a href="#216-验证执行顺序">2.16 验证执行顺序</a></li>
            <li><a href="#217-确保模拟对象上无互动发生">2.17 确保模拟对象上无互动发生</a></li>
            <li><a href="#218-找出冗余的互动即未被验证到的">2.18 找出冗余的互动(即未被验证到的)</a></li>
          </ul>
        </li>
        <li><a href="#3-mockito如何实现mocksup3sup">3 Mockito如何实现Mock<sup>[3]</sup></a></li>
        <li><a href="#参考">参考</a></li>
      </ul>
    </li>
  </ul>
</nav>


    </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="mockito-教程">Mockito 教程</h1>
<blockquote>
<p>原文： <a href="https://www.cnblogs.com/Ming8006/p/6297333.html">https://www.cnblogs.com/Ming8006/p/6297333.html</a></p>
</blockquote>
<h2 id="10-mockito-介绍-sup3sup">1.0 Mockito 介绍 <sup>[3]</sup></h2>
<h3 id="11-mockito是什么">1.1 Mockito是什么？</h3>
<p>Mockito 是 Mock 框架，它让你用简洁的 API 做测试。而且 Mockito 简单易学，它可读性强、验证语法简洁。</p>
<h3 id="12-为什么需要mock">1.2 为什么需要Mock</h3>
<p>测试驱动的开发( TDD) 要求我们先写单元测试，再写实现代码。在写单元测试的过程中，我们往往会遇到要测试的类有很多依赖，这些依赖的类、对象、资源又有别的依赖，从而形成一个大的依赖树，要在单元测试的环境中完整地构建这样的依赖，是一件很困难的事情。</p>
<h3 id="13-stub-和-mock-异同sup1sup">1.3 Stub 和 Mock 异同<sup>[1]</sup></h3>
<ul>
<li>相同：Stub 和 Mock 都是模拟外部依赖</li>
<li>不同：Stub 是完全模拟一个外部依赖， 而 Mock 还可以用来判断测试通过还是失败</li>
</ul>
<h3 id="14-使用场景">1.4 使用场景</h3>
<ul>
<li>提前创建测试</li>
<li>TDD（测试驱动开发）</li>
<li>团队可以并行工作</li>
<li>你可以创建一个验证或者演示程序</li>
<li>为无法访问的资源编写测试</li>
<li>Mock 可以交给用户</li>
<li>隔离系统</li>
</ul>
<h2 id="2-使用mockito-sup2-4sup">2 使用Mockito <sup>[2] [4]</sup></h2>
<p>添加 Maven 依赖</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;dependency&gt;</span>
    <span style="color:#f92672">&lt;groupId&gt;</span>org.mockito<span style="color:#f92672">&lt;/groupId&gt;</span>
    <span style="color:#f92672">&lt;artifactId&gt;</span>mockito-all<span style="color:#f92672">&lt;/artifactId&gt;</span>
    <span style="color:#f92672">&lt;version&gt;</span>1.10.19<span style="color:#f92672">&lt;/version&gt;</span>
    <span style="color:#f92672">&lt;scope&gt;</span>test<span style="color:#f92672">&lt;/scope&gt;</span>
<span style="color:#f92672">&lt;/dependency&gt;</span>
</code></pre></div><p>添加 JUnit依赖</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;dependency&gt;</span>
    <span style="color:#f92672">&lt;groupId&gt;</span>junit<span style="color:#f92672">&lt;/groupId&gt;</span>
    <span style="color:#f92672">&lt;artifactId&gt;</span>junit<span style="color:#f92672">&lt;/artifactId&gt;</span>
    <span style="color:#f92672">&lt;version&gt;</span>4.12<span style="color:#f92672">&lt;/version&gt;</span>
    <span style="color:#f92672">&lt;scope&gt;</span>test<span style="color:#f92672">&lt;/scope&gt;</span>
<span style="color:#f92672">&lt;/dependency&gt;</span>
</code></pre></div><p>添加引用</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import static</span> org.mockito.Mockito.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import static</span> org.junit.Assert.*<span style="color:#f92672">;</span>
</code></pre></div><h3 id="21-验证行为">2.1 验证行为</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">verifyBehaviour</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
   <span style="color:#75715e">// Mock 一个 List 对象
</span><span style="color:#75715e"></span>   List mock <span style="color:#f92672">=</span> mock<span style="color:#f92672">(</span>List<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>

   <span style="color:#75715e">// 使用 Mock 的对象
</span><span style="color:#75715e"></span>   mock<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
   mock<span style="color:#f92672">.</span><span style="color:#a6e22e">clear</span><span style="color:#f92672">();</span>

   <span style="color:#75715e">// 验证 add(1) 和 clear() 行为是否发生
</span><span style="color:#75715e"></span>   verify<span style="color:#f92672">(</span>mock<span style="color:#f92672">).</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
   verify<span style="color:#f92672">(</span>mock<span style="color:#f92672">).</span><span style="color:#a6e22e">clear</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="22-模拟期望">2.2 模拟期望</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">whenThenReturn</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// mock 一个 Iterator 类
</span><span style="color:#75715e"></span>    Iterator iterator <span style="color:#f92672">=</span> mock<span style="color:#f92672">(</span>Iterator<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>

    <span style="color:#75715e">// 预设当 iterator 调用 next() 时第一次返回 hello，第 n次 都返回 world
</span><span style="color:#75715e"></span>    when<span style="color:#f92672">(</span>iterator<span style="color:#f92672">.</span><span style="color:#a6e22e">next</span><span style="color:#f92672">()).</span><span style="color:#a6e22e">thenReturn</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;hello&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">thenReturn</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;world&#34;</span><span style="color:#f92672">);</span>

    <span style="color:#75715e">// 使用 mock 的对象
</span><span style="color:#75715e"></span>    String result <span style="color:#f92672">=</span> iterator<span style="color:#f92672">.</span><span style="color:#a6e22e">next</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">+</span> iterator<span style="color:#f92672">.</span><span style="color:#a6e22e">next</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">+</span> iterator<span style="color:#f92672">.</span><span style="color:#a6e22e">next</span><span style="color:#f92672">();</span>

    <span style="color:#75715e">//验证结果
</span><span style="color:#75715e"></span>    assertEquals<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;hello world world&#34;</span><span style="color:#f92672">,</span> result<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><blockquote>
<p><code>when(iterator.next()).thenReturn(&quot;hello&quot;).thenReturn(&quot;world&quot;);</code> 拆解后：</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">whenThenReturn</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// mock 一个 Iterator 类
</span><span style="color:#75715e"></span>    Iterator mockedIterator <span style="color:#f92672">=</span> mock<span style="color:#f92672">(</span>Iterator<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>

    <span style="color:#75715e">// 打印 class $java.util.Iterator$$EnhancerByMockitoWithCGLIB$$5f283a4b
</span><span style="color:#75715e"></span>    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>mockedIterator<span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">());</span>
    <span style="color:#75715e">// 打印 null
</span><span style="color:#75715e"></span>    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>mockedIterator<span style="color:#f92672">.</span><span style="color:#a6e22e">next</span><span style="color:#f92672">());</span>

    <span style="color:#75715e">// 预设当 iterator 调用 next() 时第一次返回 hello，第 n次 都返回 world
</span><span style="color:#75715e"></span>    OngoingStubbing<span style="color:#f92672">&lt;</span>Object<span style="color:#f92672">&gt;</span> whenStubbing <span style="color:#f92672">=</span> when<span style="color:#f92672">(</span><span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>
    OngoingStubbing<span style="color:#f92672">&lt;</span>Object<span style="color:#f92672">&gt;</span> firstStubbing <span style="color:#f92672">=</span> whenStubbing<span style="color:#f92672">.</span><span style="color:#a6e22e">thenReturn</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;hello&#34;</span><span style="color:#f92672">);</span>
    firstStubbing<span style="color:#f92672">.</span><span style="color:#a6e22e">thenReturn</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;world&#34;</span><span style="color:#f92672">);</span>


    <span style="color:#75715e">// 使用 mock 的对象
</span><span style="color:#75715e"></span>    String result <span style="color:#f92672">=</span> mockedIterator<span style="color:#f92672">.</span><span style="color:#a6e22e">next</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">+</span> mockedIterator<span style="color:#f92672">.</span><span style="color:#a6e22e">next</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">+</span> mockedIterator<span style="color:#f92672">.</span><span style="color:#a6e22e">next</span><span style="color:#f92672">();</span>

    <span style="color:#75715e">//验证结果
</span><span style="color:#75715e"></span>    assertEquals<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;hello world world&#34;</span><span style="color:#f92672">,</span> result<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="23-mock-参数">2.3 mock() 参数</h3>
<h4 id="returns_smart_nulls">RETURNS_SMART_NULLS</h4>
<p><code>RETURNS_SMART_NULLS</code> 实现了 Answer 接口的对象，它是创建 mock 对象时的一个可选参数，<code>mock(Class,Answer)</code>。</p>
<p>在创建 mock 对象时，有的方法我们没有进行 stubbing ，所以调用时会返回 <code>null</code>，这样在进行操作是很可能抛出 <code>NullPointerException</code>。如果通过 <code>RETURNS_SMART_NULLS</code> 参数创建的 mock对象 在没有调用 <code>stubbed</code>方法时会返回 <code>SmartNull</code>。例如：</p>
<ul>
<li>返回类型是 <code>String</code>，会返回<code>&quot;&quot;</code></li>
<li><code>int</code>，会返回 <code>0</code></li>
<li><code>List</code>，会返回空的List</li>
<li>另外，在控制台窗口中可以看到SmartNull的友好提示。</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">returnsSmartNullsTest</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    List mock <span style="color:#f92672">=</span> mock<span style="color:#f92672">(</span>List<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> RETURNS_SMART_NULLS<span style="color:#f92672">);</span>

    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>mock<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>0<span style="color:#f92672">));</span>

    <span style="color:#75715e">// 使用 RETURNS_SMART_NULLS 参数创建的mock对象，
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// 不会抛出NullPointerException异常
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// 另外控制台窗口会提示信息 SmartNull returned by this unstubbed method call on a mock:
</span><span style="color:#75715e"></span>    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>mock<span style="color:#f92672">.</span><span style="color:#a6e22e">toArray</span><span style="color:#f92672">().</span><span style="color:#a6e22e">length</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="returns_deep_stubs">RETURNS_DEEP_STUBS</h4>
<p><code>RETURNS_DEEP_STUBS</code> 参数程序会自动进行 mock 所需的对象，以下两个测试用例是等价的</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">deepStubsTest</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    Account account <span style="color:#f92672">=</span> mock<span style="color:#f92672">(</span>Account<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> RETURNS_DEEP_STUBS<span style="color:#f92672">);</span>

    when<span style="color:#f92672">(</span>account<span style="color:#f92672">.</span><span style="color:#a6e22e">getRailwayTicket</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getDestination</span><span style="color:#f92672">()).</span><span style="color:#a6e22e">thenReturn</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Beijing&#34;</span><span style="color:#f92672">);</span>

    account<span style="color:#f92672">.</span><span style="color:#a6e22e">getRailwayTicket</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getDestination</span><span style="color:#f92672">();</span>
    
    verify<span style="color:#f92672">(</span>account<span style="color:#f92672">.</span><span style="color:#a6e22e">getRailwayTicket</span><span style="color:#f92672">()).</span><span style="color:#a6e22e">getDestination</span><span style="color:#f92672">();</span>

    assertEquals<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Beijing&#34;</span><span style="color:#f92672">,</span> account<span style="color:#f92672">.</span><span style="color:#a6e22e">getRailwayTicket</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getDestination</span><span style="color:#f92672">());</span>
<span style="color:#f92672">}</span>

<span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">deepStubsTest2</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    Account account <span style="color:#f92672">=</span> mock<span style="color:#f92672">(</span>Account<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
    RailwayTicket railwayTicket <span style="color:#f92672">=</span> mock<span style="color:#f92672">(</span>RailwayTicket<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>

    when<span style="color:#f92672">(</span>account<span style="color:#f92672">.</span><span style="color:#a6e22e">getRailwayTicket</span><span style="color:#f92672">()).</span><span style="color:#a6e22e">thenReturn</span><span style="color:#f92672">(</span>railwayTicket<span style="color:#f92672">);</span>
    when<span style="color:#f92672">(</span>railwayTicket<span style="color:#f92672">.</span><span style="color:#a6e22e">getDestination</span><span style="color:#f92672">()).</span><span style="color:#a6e22e">thenReturn</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Beijing&#34;</span><span style="color:#f92672">);</span>

    account<span style="color:#f92672">.</span><span style="color:#a6e22e">getRailwayTicket</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getDestination</span><span style="color:#f92672">();</span>
    verify<span style="color:#f92672">(</span>account<span style="color:#f92672">.</span><span style="color:#a6e22e">getRailwayTicket</span><span style="color:#f92672">()).</span><span style="color:#a6e22e">getDestination</span><span style="color:#f92672">();</span>

    assertEquals<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Beijing&#34;</span><span style="color:#f92672">,</span> account<span style="color:#f92672">.</span><span style="color:#a6e22e">getRailwayTicket</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getDestination</span><span style="color:#f92672">());</span>
<span style="color:#f92672">}</span>

<span style="color:#a6e22e">@lombok.Data</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RailwayTicket</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> String destination<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#a6e22e">@lombok.Data</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Account</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> RailwayTicket railwayTicket<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="24-模拟抛出异常">2.4 模拟抛出异常</h3>
<p>模拟 IO 异常</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span><span style="color:#f92672">(</span>expected <span style="color:#f92672">=</span> IOException<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">whenThenThrow</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException <span style="color:#f92672">{</span>
    <span style="color:#75715e">// Mock 一个 Stream
</span><span style="color:#75715e"></span>    OutputStream outputStream <span style="color:#f92672">=</span> mock<span style="color:#f92672">(</span>OutputStream<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>

    <span style="color:#75715e">//预设当流关闭时抛出异常
</span><span style="color:#75715e"></span>    doThrow<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> IOException<span style="color:#f92672">()).</span><span style="color:#a6e22e">when</span><span style="color:#f92672">(</span>outputStream<span style="color:#f92672">).</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>

    outputStream<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>让指定的操作抛出异常</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span><span style="color:#f92672">(</span>expected <span style="color:#f92672">=</span> RuntimeException<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doThrowWhen</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    List list <span style="color:#f92672">=</span> mock<span style="color:#f92672">(</span>List<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>

    doThrow<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> RuntimeException<span style="color:#f92672">()).</span><span style="color:#a6e22e">when</span><span style="color:#f92672">(</span>list<span style="color:#f92672">).</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>

  	<span style="color:#75715e">// 抛出 Runtime Exception
</span><span style="color:#75715e"></span>    list<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="25-mock-注解">2.5 @Mock 注解</h3>
<p>在上面的测试中我们在每个测试方法里都mock了一个List对象，为了避免重复的mock，是测试类更具有可读性，我们可以使用下面的注解方式来快速模拟对象：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Mock</span>
<span style="color:#66d9ef">private</span> List mockList<span style="color:#f92672">;</span>
</code></pre></div><p>再用注解的 mock 对象试试</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">shorthand</span><span style="color:#f92672">(){</span>
    mockList<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
    verify<span style="color:#f92672">(</span>mockList<span style="color:#f92672">).</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>运行这个测试类你会发现报错了，mock 的对象为 <code>NULL</code>，为此我们必须在基类中添加初始化mock的代码</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MockitoExample2</span> <span style="color:#f92672">{</span>
  
    <span style="color:#a6e22e">@Mock</span>
    <span style="color:#66d9ef">private</span> List mockList<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">MockitoExample2</span><span style="color:#f92672">(){</span>
        MockitoAnnotations<span style="color:#f92672">.</span><span style="color:#a6e22e">initMocks</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    
    <span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">shorthand</span><span style="color:#f92672">(){</span>
        mockList<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
        verify<span style="color:#f92672">(</span>mockList<span style="color:#f92672">).</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>或者使用 built-in runner：MockitoJUnitRunner</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RunWith</span><span style="color:#f92672">(</span>MockitoJUnitRunner<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MockitoExample2</span> <span style="color:#f92672">{</span>
  
    <span style="color:#a6e22e">@Mock</span>
    <span style="color:#66d9ef">private</span> List mockList<span style="color:#f92672">;</span>

    <span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">shorthand</span><span style="color:#f92672">(){</span>
        mockList<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
        verify<span style="color:#f92672">(</span>mockList<span style="color:#f92672">).</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="26-参数匹配">2.6 参数匹配</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">withArguments</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    Comparable comparable <span style="color:#f92672">=</span> mock<span style="color:#f92672">(</span>Comparable<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
  
    <span style="color:#75715e">// 预设根据不同的参数返回不同的结果
</span><span style="color:#75715e"></span>    when<span style="color:#f92672">(</span>comparable<span style="color:#f92672">.</span><span style="color:#a6e22e">compareTo</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Test&#34;</span><span style="color:#f92672">)).</span><span style="color:#a6e22e">thenReturn</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
    when<span style="color:#f92672">(</span>comparable<span style="color:#f92672">.</span><span style="color:#a6e22e">compareTo</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Omg&#34;</span><span style="color:#f92672">)).</span><span style="color:#a6e22e">thenReturn</span><span style="color:#f92672">(</span>2<span style="color:#f92672">);</span>
  
    assertEquals<span style="color:#f92672">(</span>1<span style="color:#f92672">,</span> comparable<span style="color:#f92672">.</span><span style="color:#a6e22e">compareTo</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Test&#34;</span><span style="color:#f92672">));</span>
    assertEquals<span style="color:#f92672">(</span>2<span style="color:#f92672">,</span> comparable<span style="color:#f92672">.</span><span style="color:#a6e22e">compareTo</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Omg&#34;</span><span style="color:#f92672">));</span>
  
    <span style="color:#75715e">// 对于没有预设的情况会返回默认值
</span><span style="color:#75715e"></span>    assertEquals<span style="color:#f92672">(</span>0<span style="color:#f92672">,</span> comparable<span style="color:#f92672">.</span><span style="color:#a6e22e">compareTo</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Not stub&#34;</span><span style="color:#f92672">));</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>除了匹配制定参数外，还可以匹配自己想要的任意参数</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">withUnspecifiedArguments</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    List list <span style="color:#f92672">=</span> mock<span style="color:#f92672">(</span>List<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>

    <span style="color:#75715e">// 匹配任意参数
</span><span style="color:#75715e"></span>    when<span style="color:#f92672">(</span>list<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>Matchers<span style="color:#f92672">.</span><span style="color:#a6e22e">anyInt</span><span style="color:#f92672">())).</span><span style="color:#a6e22e">thenReturn</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
    when<span style="color:#f92672">(</span>list<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>Matchers<span style="color:#f92672">.</span><span style="color:#a6e22e">argThat</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> IsValid<span style="color:#f92672">()))).</span><span style="color:#a6e22e">thenReturn</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">);</span>

    assertEquals<span style="color:#f92672">(</span>1<span style="color:#f92672">,</span> list<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>1<span style="color:#f92672">));</span>
    assertEquals<span style="color:#f92672">(</span>1<span style="color:#f92672">,</span> list<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>999<span style="color:#f92672">));</span>

    assertTrue<span style="color:#f92672">(</span>list<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>1<span style="color:#f92672">));</span>
    assertFalse<span style="color:#f92672">(</span>list<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>3<span style="color:#f92672">));</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IsValid</span> <span style="color:#66d9ef">extends</span> ArgumentMatcher<span style="color:#f92672">&lt;</span>List<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">matches</span><span style="color:#f92672">(</span>Object o<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> Objects<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>o<span style="color:#f92672">,</span> 1<span style="color:#f92672">)</span> <span style="color:#f92672">||</span> Objects<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>o<span style="color:#f92672">,</span> 2<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>注意：如果你使用了参数匹配，那么所有的参数都必须通过 matchers 来匹配，如下代码：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">allArgumentsProvidedByMatchers</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    Comparator comparator <span style="color:#f92672">=</span> mock<span style="color:#f92672">(</span>Comparator<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
    comparator<span style="color:#f92672">.</span><span style="color:#a6e22e">compare</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;nihao&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;hello&#34;</span><span style="color:#f92672">);</span>

    <span style="color:#75715e">// 如果你使用了参数匹配，那么所有的参数都必须通过 matchers 来匹配
</span><span style="color:#75715e"></span>    verify<span style="color:#f92672">(</span>comparator<span style="color:#f92672">).</span><span style="color:#a6e22e">compare</span><span style="color:#f92672">(</span>Matchers<span style="color:#f92672">.</span><span style="color:#a6e22e">anyString</span><span style="color:#f92672">(),</span> Matchers<span style="color:#f92672">.</span><span style="color:#a6e22e">eq</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;hello&#34;</span><span style="color:#f92672">));</span>

    <span style="color:#75715e">// 下面的为无效的参数匹配使用
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// verify(comparator).compare(Matchers.anyString(), &#34;hello&#34;);
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</code></pre></div><h3 id="27-自定义参数匹配">2.7 自定义参数匹配</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">argumentMatchersTest</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// 创建mock对象
</span><span style="color:#75715e"></span>    List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> mock <span style="color:#f92672">=</span> mock<span style="color:#f92672">(</span>List<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>

    <span style="color:#75715e">// argThat(Matches&lt;T&gt; matcher)方法用来应用自定义的规则，可以传入任何实现 Matcher 接口的实现类。
</span><span style="color:#75715e"></span>    when<span style="color:#f92672">(</span>mock<span style="color:#f92672">.</span><span style="color:#a6e22e">addAll</span><span style="color:#f92672">(</span>argThat<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> IsListofTwoElements<span style="color:#f92672">()))).</span><span style="color:#a6e22e">thenReturn</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">);</span>

    mock<span style="color:#f92672">.</span><span style="color:#a6e22e">addAll</span><span style="color:#f92672">(</span>Arrays<span style="color:#f92672">.</span><span style="color:#a6e22e">asList</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;one&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;two&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;three&#34;</span><span style="color:#f92672">));</span>

    <span style="color:#75715e">// IsListofTwoElements 用来匹配 size 为 2 的 List，因为例子传入 List 为三个元素，所以此时将失败。
</span><span style="color:#75715e"></span>    verify<span style="color:#f92672">(</span>mock<span style="color:#f92672">).</span><span style="color:#a6e22e">addAll</span><span style="color:#f92672">(</span>argThat<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> IsListofTwoElements<span style="color:#f92672">()));</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IsListofTwoElements</span> <span style="color:#66d9ef">extends</span> ArgumentMatcher<span style="color:#f92672">&lt;</span>List<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">matches</span><span style="color:#f92672">(</span>Object list<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#f92672">((</span>List<span style="color:#f92672">)</span> list<span style="color:#f92672">).</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> 2<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="28-参数捕获器">2.8 参数捕获器</h3>
<p>较复杂的参数匹配器会降低代码的可读性，有些地方使用<strong>参数捕获器</strong>更加合适。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">capturingArgs</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    PersonDao personDao <span style="color:#f92672">=</span> mock<span style="color:#f92672">(</span>PersonDao<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
    ArgumentCaptor<span style="color:#f92672">&lt;</span>Person<span style="color:#f92672">&gt;</span> argument <span style="color:#f92672">=</span> ArgumentCaptor<span style="color:#f92672">.</span><span style="color:#a6e22e">forClass</span><span style="color:#f92672">(</span>Person<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>

    PersonService personService <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> PersonService<span style="color:#f92672">(</span>personDao<span style="color:#f92672">);</span>
    personService<span style="color:#f92672">.</span><span style="color:#a6e22e">update</span><span style="color:#f92672">(</span>1<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;jack&#34;</span><span style="color:#f92672">);</span>

    verify<span style="color:#f92672">(</span>personDao<span style="color:#f92672">).</span><span style="color:#a6e22e">update</span><span style="color:#f92672">(</span>argument<span style="color:#f92672">.</span><span style="color:#a6e22e">capture</span><span style="color:#f92672">());</span>

    assertEquals<span style="color:#f92672">(</span>1<span style="color:#f92672">,</span> argument<span style="color:#f92672">.</span><span style="color:#a6e22e">getValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getId</span><span style="color:#f92672">());</span>
    assertEquals<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;jack&#34;</span><span style="color:#f92672">,</span> argument<span style="color:#f92672">.</span><span style="color:#a6e22e">getValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">());</span>
<span style="color:#f92672">}</span>

<span style="color:#a6e22e">@Data</span>
<span style="color:#a6e22e">@AllArgsConstructor</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Person</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> id<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String name<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">PersonDao</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">update</span><span style="color:#f92672">(</span>Person person<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>

<span style="color:#a6e22e">@AllArgsConstructor</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PersonService</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">private</span> PersonDao personDao<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">update</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> id<span style="color:#f92672">,</span> String name<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        personDao<span style="color:#f92672">.</span><span style="color:#a6e22e">update</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Person<span style="color:#f92672">(</span>id<span style="color:#f92672">,</span> name<span style="color:#f92672">));</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="29-answer">2.9 Answer</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">answerTest</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    List mockList <span style="color:#f92672">=</span> mock<span style="color:#f92672">(</span>List<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>

    when<span style="color:#f92672">(</span>mockList<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>anyInt<span style="color:#f92672">())).</span><span style="color:#a6e22e">thenAnswer</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> CustomAnswer<span style="color:#f92672">());</span>
    
    assertEquals<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;hello world:0&#34;</span><span style="color:#f92672">,</span> mockList<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>0<span style="color:#f92672">));</span>
    assertEquals<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;hello world:999&#34;</span><span style="color:#f92672">,</span> mockList<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>999<span style="color:#f92672">));</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CustomAnswer</span> <span style="color:#66d9ef">implements</span> Answer<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">answer</span><span style="color:#f92672">(</span>InvocationOnMock invocation<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Throwable <span style="color:#f92672">{</span>
        Object<span style="color:#f92672">[]</span> args <span style="color:#f92672">=</span> invocation<span style="color:#f92672">.</span><span style="color:#a6e22e">getArguments</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;hello world:&#34;</span> <span style="color:#f92672">+</span> args<span style="color:#f92672">[</span>0<span style="color:#f92672">];</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>也可使用匿名内部类实现</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">answerWithAallback</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    List mockList <span style="color:#f92672">=</span> mock<span style="color:#f92672">(</span>List<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>

    <span style="color:#75715e">// 使用Answer来生成我们我们期望的返回
</span><span style="color:#75715e"></span>    when<span style="color:#f92672">(</span>mockList<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>anyInt<span style="color:#f92672">())).</span><span style="color:#a6e22e">thenAnswer</span><span style="color:#f92672">(</span>invocation <span style="color:#f92672">-&gt;</span> <span style="color:#e6db74">&#34;hello world:&#34;</span> <span style="color:#f92672">+</span> invocation<span style="color:#f92672">.</span><span style="color:#a6e22e">getArguments</span><span style="color:#f92672">()[</span>0<span style="color:#f92672">]);</span>

    assertEquals<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;hello world:0&#34;</span><span style="color:#f92672">,</span> mockList<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>0<span style="color:#f92672">));</span>
    assertEquals<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;hello world:999&#34;</span><span style="color:#f92672">,</span> mockList<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>999<span style="color:#f92672">));</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="210-未预设调用的默认期望">2.10 未预设调用的默认期望</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">unstubbedInvocations</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// mock对象使用Answer来对未预设的调用返回默认期望值
</span><span style="color:#75715e"></span>    List mock <span style="color:#f92672">=</span> mock<span style="color:#f92672">(</span>List<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span>Answer<span style="color:#f92672">)</span> invocation <span style="color:#f92672">-&gt;</span> 999<span style="color:#f92672">);</span>

    <span style="color:#75715e">// 下面的get(1)没有预设，通常情况下会返回NULL，但是使用了Answer改变了默认期望值
</span><span style="color:#75715e"></span>    assertEquals<span style="color:#f92672">(</span>999<span style="color:#f92672">,</span> mock<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>1<span style="color:#f92672">));</span>
    <span style="color:#75715e">// 下面的size()没有预设，通常情况下会返回0，但是使用了Answer改变了默认期望值
</span><span style="color:#75715e"></span>    assertEquals<span style="color:#f92672">(</span>999<span style="color:#f92672">,</span> mock<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">());</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="211-spy">2.11 spy</h3>
<ul>
<li><code>Mock</code> 不是真实的对象，它只是创建了一个虚拟对象，并可以设置对象行为</li>
<li><code>Spy</code> 是一个真实的对象，但它可以设置对象行为</li>
<li><code>InjectMocks</code> 创建类的对象并自动将标记 <code>@Mock</code>、<code>@Spy</code> 等注解的属性值注入到这个中</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span><span style="color:#f92672">(</span>expected <span style="color:#f92672">=</span> IndexOutOfBoundsException<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">spyOnRealObjects</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    List realList <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> LinkedList<span style="color:#f92672">();</span>
    List spyList <span style="color:#f92672">=</span> spy<span style="color:#f92672">(</span>realList<span style="color:#f92672">);</span>

    <span style="color:#75715e">// 下面预设的 spy.get(0) 会报错，因为会调用真实对象的 get(0)，所以会抛出越界异常
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// when(spy.get(0)).thenReturn(3);
</span><span style="color:#75715e"></span>
    <span style="color:#75715e">// 使用 doReturn-when 可以避免 when-thenReturn 调用真实对象 api
</span><span style="color:#75715e"></span>    doReturn<span style="color:#f92672">(</span>999<span style="color:#f92672">).</span><span style="color:#a6e22e">when</span><span style="color:#f92672">(</span>spyList<span style="color:#f92672">).</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>999<span style="color:#f92672">);</span>

    <span style="color:#75715e">// 预设 size() 期望值
</span><span style="color:#75715e"></span>    when<span style="color:#f92672">(</span>spyList<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()).</span><span style="color:#a6e22e">thenReturn</span><span style="color:#f92672">(</span>100<span style="color:#f92672">);</span>

    <span style="color:#75715e">// 调用真实对象的api
</span><span style="color:#75715e"></span>    spyList<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
    spyList<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>2<span style="color:#f92672">);</span>

    assertEquals<span style="color:#f92672">(</span>100<span style="color:#f92672">,</span> spyList<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">());</span>
    assertEquals<span style="color:#f92672">(</span>1<span style="color:#f92672">,</span> spyList<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>0<span style="color:#f92672">));</span>
    assertEquals<span style="color:#f92672">(</span>2<span style="color:#f92672">,</span> spyList<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>1<span style="color:#f92672">));</span>

    verify<span style="color:#f92672">(</span>spyList<span style="color:#f92672">).</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
    verify<span style="color:#f92672">(</span>spyList<span style="color:#f92672">).</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>2<span style="color:#f92672">);</span>

    assertEquals<span style="color:#f92672">(</span>999<span style="color:#f92672">,</span> spyList<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>999<span style="color:#f92672">));</span>
    
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="212-真实-mock">2.12 真实 Mock</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">realPartialMock</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    ArrayList realList <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">();</span>
    List spyList <span style="color:#f92672">=</span> spy<span style="color:#f92672">(</span>realList<span style="color:#f92672">);</span>

    assertEquals<span style="color:#f92672">(</span>0<span style="color:#f92672">,</span> spyList<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">());</span>

    A a <span style="color:#f92672">=</span> mock<span style="color:#f92672">(</span>A<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>

    <span style="color:#75715e">// 通过thenCallRealMethod来调用真实的api
</span><span style="color:#75715e"></span>    when<span style="color:#f92672">(</span>a<span style="color:#f92672">.</span><span style="color:#a6e22e">doSomething</span><span style="color:#f92672">(</span>anyInt<span style="color:#f92672">())).</span><span style="color:#a6e22e">thenCallRealMethod</span><span style="color:#f92672">();</span>
    
    assertEquals<span style="color:#f92672">(</span>999<span style="color:#f92672">,</span> a<span style="color:#f92672">.</span><span style="color:#a6e22e">doSomething</span><span style="color:#f92672">(</span>999<span style="color:#f92672">));</span>
<span style="color:#f92672">}</span>


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">A</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">doSomething</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> i<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="213-重置-mock">2.13 重置 Mock</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">resetMock</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    List mockList <span style="color:#f92672">=</span> mock<span style="color:#f92672">(</span>List<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
    when<span style="color:#f92672">(</span>mockList<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()).</span><span style="color:#a6e22e">thenReturn</span><span style="color:#f92672">(</span>10<span style="color:#f92672">);</span>

    <span style="color:#75715e">// list 行为被重新，这个 add 操作并没有实际意义
</span><span style="color:#75715e"></span>    mockList<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
    assertEquals<span style="color:#f92672">(</span>10<span style="color:#f92672">,</span> mockList<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">());</span>

    <span style="color:#75715e">// 重置mock，清除所有的互动和预设
</span><span style="color:#75715e"></span>    reset<span style="color:#f92672">(</span>mockList<span style="color:#f92672">);</span>
    assertEquals<span style="color:#f92672">(</span>0<span style="color:#f92672">,</span> mockList<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">());</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="214-验证调用次数">2.14 验证调用次数</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">verifyingNumberOfInvocations</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    List list <span style="color:#f92672">=</span> mock<span style="color:#f92672">(</span>List<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
    list<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
    list<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>2<span style="color:#f92672">);</span>
    list<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>2<span style="color:#f92672">);</span>
    list<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>3<span style="color:#f92672">);</span>
    list<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>3<span style="color:#f92672">);</span>
    list<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>3<span style="color:#f92672">);</span>

    <span style="color:#75715e">//验证是否被调用一次，等效于下面的times(1)
</span><span style="color:#75715e"></span>    verify<span style="color:#f92672">(</span>list<span style="color:#f92672">).</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
    verify<span style="color:#f92672">(</span>list<span style="color:#f92672">,</span> times<span style="color:#f92672">(</span>1<span style="color:#f92672">)).</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>

    <span style="color:#75715e">//验证是否被调用2次
</span><span style="color:#75715e"></span>    verify<span style="color:#f92672">(</span>list<span style="color:#f92672">,</span> times<span style="color:#f92672">(</span>2<span style="color:#f92672">)).</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>2<span style="color:#f92672">);</span>
    <span style="color:#75715e">//验证是否被调用3次
</span><span style="color:#75715e"></span>    verify<span style="color:#f92672">(</span>list<span style="color:#f92672">,</span> times<span style="color:#f92672">(</span>3<span style="color:#f92672">)).</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>3<span style="color:#f92672">);</span>

    <span style="color:#75715e">//验证是否从未被调用过
</span><span style="color:#75715e"></span>    verify<span style="color:#f92672">(</span>list<span style="color:#f92672">,</span> never<span style="color:#f92672">()).</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>4<span style="color:#f92672">);</span>

    <span style="color:#75715e">//验证至少调用一次
</span><span style="color:#75715e"></span>    verify<span style="color:#f92672">(</span>list<span style="color:#f92672">,</span> atLeastOnce<span style="color:#f92672">()).</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
    <span style="color:#75715e">//验证至少调用2次
</span><span style="color:#75715e"></span>    verify<span style="color:#f92672">(</span>list<span style="color:#f92672">,</span> atLeast<span style="color:#f92672">(</span>2<span style="color:#f92672">)).</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>2<span style="color:#f92672">);</span>
    <span style="color:#75715e">//验证至多调用3次
</span><span style="color:#75715e"></span>    verify<span style="color:#f92672">(</span>list<span style="color:#f92672">,</span> atMost<span style="color:#f92672">(</span>3<span style="color:#f92672">)).</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>3<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="215-when-then-注意事项">2.15 when-then 注意事项</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span><span style="color:#f92672">(</span>expected <span style="color:#f92672">=</span> RuntimeException<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">consecutiveCalls</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    List mockList <span style="color:#f92672">=</span> mock<span style="color:#f92672">(</span>List<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
    
    <span style="color:#75715e">// 模拟连续调用返回期望值，如果分开，则只有最后一个有效
</span><span style="color:#75715e"></span>    when<span style="color:#f92672">(</span>mockList<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)).</span><span style="color:#a6e22e">thenReturn</span><span style="color:#f92672">(</span>0<span style="color:#f92672">);</span>
    when<span style="color:#f92672">(</span>mockList<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)).</span><span style="color:#a6e22e">thenReturn</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
    when<span style="color:#f92672">(</span>mockList<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)).</span><span style="color:#a6e22e">thenReturn</span><span style="color:#f92672">(</span>2<span style="color:#f92672">);</span>
    
    when<span style="color:#f92672">(</span>mockList<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>1<span style="color:#f92672">)).</span><span style="color:#a6e22e">thenReturn</span><span style="color:#f92672">(</span>0<span style="color:#f92672">).</span><span style="color:#a6e22e">thenReturn</span><span style="color:#f92672">(</span>1<span style="color:#f92672">).</span><span style="color:#a6e22e">thenThrow</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> RuntimeException<span style="color:#f92672">());</span>
    
    assertEquals<span style="color:#f92672">(</span>2<span style="color:#f92672">,</span> mockList<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>0<span style="color:#f92672">));</span>
    assertEquals<span style="color:#f92672">(</span>2<span style="color:#f92672">,</span> mockList<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>0<span style="color:#f92672">));</span>
    assertEquals<span style="color:#f92672">(</span>0<span style="color:#f92672">,</span> mockList<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>1<span style="color:#f92672">));</span>
    assertEquals<span style="color:#f92672">(</span>1<span style="color:#f92672">,</span> mockList<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>1<span style="color:#f92672">));</span>
    
    <span style="color:#75715e">// 第三次或更多调用都会抛出异常
</span><span style="color:#75715e"></span>    mockList<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="216-验证执行顺序">2.16 验证执行顺序</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">verificationInOrder</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    List list <span style="color:#f92672">=</span> mock<span style="color:#f92672">(</span>List<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
    List list2 <span style="color:#f92672">=</span> mock<span style="color:#f92672">(</span>List<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
    list<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
    list2<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;hello&#34;</span><span style="color:#f92672">);</span>

    list2<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;world&#34;</span><span style="color:#f92672">);</span>

    <span style="color:#75715e">// 将需要排序的mock对象放入InOrder
</span><span style="color:#75715e"></span>    InOrder inOrder <span style="color:#f92672">=</span> inOrder<span style="color:#f92672">(</span>list<span style="color:#f92672">,</span> list2<span style="color:#f92672">);</span>

    <span style="color:#75715e">// 下面的代码不能颠倒顺序，验证执行顺序
</span><span style="color:#75715e"></span>    inOrder<span style="color:#f92672">.</span><span style="color:#a6e22e">verify</span><span style="color:#f92672">(</span>list<span style="color:#f92672">).</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
    inOrder<span style="color:#f92672">.</span><span style="color:#a6e22e">verify</span><span style="color:#f92672">(</span>list2<span style="color:#f92672">).</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;hello&#34;</span><span style="color:#f92672">);</span>
    inOrder<span style="color:#f92672">.</span><span style="color:#a6e22e">verify</span><span style="color:#f92672">(</span>list<span style="color:#f92672">).</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>2<span style="color:#f92672">);</span>
    inOrder<span style="color:#f92672">.</span><span style="color:#a6e22e">verify</span><span style="color:#f92672">(</span>list2<span style="color:#f92672">).</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;world&#34;</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="217-确保模拟对象上无互动发生">2.17 确保模拟对象上无互动发生</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">verifyInteraction</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    List list <span style="color:#f92672">=</span> mock<span style="color:#f92672">(</span>List<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
    List list2 <span style="color:#f92672">=</span> mock<span style="color:#f92672">(</span>List<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
    List list3 <span style="color:#f92672">=</span> mock<span style="color:#f92672">(</span>List<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>

    list<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>

    verify<span style="color:#f92672">(</span>list<span style="color:#f92672">).</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
    verify<span style="color:#f92672">(</span>list<span style="color:#f92672">,</span> never<span style="color:#f92672">()).</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>2<span style="color:#f92672">);</span>

    <span style="color:#75715e">// 验证零互动行为
</span><span style="color:#75715e"></span>    verifyZeroInteractions<span style="color:#f92672">(</span>list2<span style="color:#f92672">,</span> list3<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="218-找出冗余的互动即未被验证到的">2.18 找出冗余的互动(即未被验证到的)</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span><span style="color:#f92672">(</span>expected <span style="color:#f92672">=</span> NoInteractionsWanted<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">findRedundantInteraction</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    List list <span style="color:#f92672">=</span> mock<span style="color:#f92672">(</span>List<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
    list<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
    list<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>2<span style="color:#f92672">);</span>
    verify<span style="color:#f92672">(</span>list<span style="color:#f92672">,</span> times<span style="color:#f92672">(</span>2<span style="color:#f92672">)).</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>anyInt<span style="color:#f92672">());</span>
    <span style="color:#75715e">// 检查是否有未被验证的互动行为，
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// 因为 add(1) 和 add(2) 都会被上面的 anyInt() 验证到，所以下面的代码会通过
</span><span style="color:#75715e"></span>    verifyNoMoreInteractions<span style="color:#f92672">(</span>list<span style="color:#f92672">);</span>

    List list2 <span style="color:#f92672">=</span> mock<span style="color:#f92672">(</span>List<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
    list2<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
    list2<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>2<span style="color:#f92672">);</span>
    verify<span style="color:#f92672">(</span>list2<span style="color:#f92672">).</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
    <span style="color:#75715e">// 检查是否有未被验证的互动行为，因为add(2)没有被验证，所以下面的代码会失败抛出异常
</span><span style="color:#75715e"></span>    verifyNoMoreInteractions<span style="color:#f92672">(</span>list2<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="3-mockito如何实现mocksup3sup">3 Mockito如何实现Mock<sup>[3]</sup></h2>
<p>Mockito 并不是创建一个真实的对象，而是模拟这个对象，他用简单的<code>when(mock.method(params)).thenRetrun(result)</code> 语句设置mock对象的行为，如下语句：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">// 设置 mock 对象的行为
</span><span style="color:#75715e">// 当调用其 get 方法获取第0个元素时，返回&#34;first&#34;
</span><span style="color:#75715e"></span>Mockito<span style="color:#f92672">.</span><span style="color:#a6e22e">when</span><span style="color:#f92672">(</span>mockedList<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)).</span><span style="color:#a6e22e">thenReturn</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;first&#34;</span><span style="color:#f92672">);</span>
</code></pre></div><p>在 Mock 对象的时候，创建一个 proxy 对象，保存被调用的方法名 <code>get</code>，以及调用时候传递的参数 <code>0</code>，然后在调用 <code>thenReturn</code> 方法时再把 <code>first</code> 保存起来，这样，就有了构建一个 <code>stub</code> 方法所需的所有信息，构建一个<code>stub</code>。当 get 方法被调用的时候，实际上调用的是之前保存的 proxy 对象的 <code>get</code> 方法，返回之前保存的数据。</p>
<h2 id="参考">参考</h2>
<ul>
<li>[1] 
  <a href="https://www.cnblogs.com/TankXiao/archive/2012/03/06/2366073.html#diff">单元测试之 Stub 和 Mock</a></li>
<li>[2] 
  <a href="http://blog.csdn.net/sdyy321/article/details/38757135/">Mockito 简单教程</a></li>
<li>[3] 
  <a href="http://blog.csdn.net/jhg19900321/article/details/49531983">Mockito 入门</a></li>
<li>[4] 
  <a href="http://wenku.baidu.com/view/8def451a227916888486d73f.html">学习 Mockito</a></li>
</ul>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex justify-between">



  <div>
    
    <a class="flex align-center" href="https://github.com/hello-world-example/Mock/commit/e079c4936c5c6932844a91566934fa16d211c856" title='Last modified by kaibin.yang | Jan 26, 2021' target="_blank" rel="noopener">
      <img src="/Mock/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>Jan 26, 2021</span>
    </a>
  </div>



  <div>
    <a class="flex align-center" href="https://github.com/hello-world-example/Mock/edit/master/HuGo/content/docs/mockito/Mockito-Tutorial.md" target="_blank" rel="noopener">
      <img src="/Mock/svg/edit.svg" class="book-icon" alt="Edit" />
      <span>Edit this page</span>
    </a>
  </div>

</div>

 
        
<script>
var images = document.getElementsByTagName("img")
console.info(images.length)
for(var i=0; i<images.length; i++){
  var image = images[i]
  var src = image.getAttribute("src");
  if(src.startsWith("-images")){
    image.setAttribute("src", "../" + src)
  }
}
</script>

      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#mockito-教程">Mockito 教程</a>
      <ul>
        <li><a href="#10-mockito-介绍-sup3sup">1.0 Mockito 介绍 <sup>[3]</sup></a>
          <ul>
            <li><a href="#11-mockito是什么">1.1 Mockito是什么？</a></li>
            <li><a href="#12-为什么需要mock">1.2 为什么需要Mock</a></li>
            <li><a href="#13-stub-和-mock-异同sup1sup">1.3 Stub 和 Mock 异同<sup>[1]</sup></a></li>
            <li><a href="#14-使用场景">1.4 使用场景</a></li>
          </ul>
        </li>
        <li><a href="#2-使用mockito-sup2-4sup">2 使用Mockito <sup>[2] [4]</sup></a>
          <ul>
            <li><a href="#21-验证行为">2.1 验证行为</a></li>
            <li><a href="#22-模拟期望">2.2 模拟期望</a></li>
            <li><a href="#23-mock-参数">2.3 mock() 参数</a></li>
            <li><a href="#24-模拟抛出异常">2.4 模拟抛出异常</a></li>
            <li><a href="#25-mock-注解">2.5 @Mock 注解</a></li>
            <li><a href="#26-参数匹配">2.6 参数匹配</a></li>
            <li><a href="#27-自定义参数匹配">2.7 自定义参数匹配</a></li>
            <li><a href="#28-参数捕获器">2.8 参数捕获器</a></li>
            <li><a href="#29-answer">2.9 Answer</a></li>
            <li><a href="#210-未预设调用的默认期望">2.10 未预设调用的默认期望</a></li>
            <li><a href="#211-spy">2.11 spy</a></li>
            <li><a href="#212-真实-mock">2.12 真实 Mock</a></li>
            <li><a href="#213-重置-mock">2.13 重置 Mock</a></li>
            <li><a href="#214-验证调用次数">2.14 验证调用次数</a></li>
            <li><a href="#215-when-then-注意事项">2.15 when-then 注意事项</a></li>
            <li><a href="#216-验证执行顺序">2.16 验证执行顺序</a></li>
            <li><a href="#217-确保模拟对象上无互动发生">2.17 确保模拟对象上无互动发生</a></li>
            <li><a href="#218-找出冗余的互动即未被验证到的">2.18 找出冗余的互动(即未被验证到的)</a></li>
          </ul>
        </li>
        <li><a href="#3-mockito如何实现mocksup3sup">3 Mockito如何实现Mock<sup>[3]</sup></a></li>
        <li><a href="#参考">参考</a></li>
      </ul>
    </li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  
</body>

</html>












